# Admin Dashboard Overview (Flask/Jinja)

## 1. Goal

Enhance the existing Flask/Jinja-based admin interface located in `api/templates/admin/` to provide a functional dashboard for managing access logs and employees, interacting directly with the backend Flask routes in `api/routes/`.

## 2. Core Features & Navigation

*   **Multi-Page Application:** Standard Flask application serving HTML pages.
*   **Technology Stack:**
    *   **Backend Framework:** Flask (serving HTML)
    *   **Templating:** Jinja2
    *   **Styling:** Bootstrap 5 (via CDN), Bootstrap Table (via CDN), potentially additional custom CSS.
    *   **Frontend Logic:** Minimal vanilla JavaScript for specific features (e.g., polling).
*   **Side Navigation Bar:**
    *   Implemented directly within the base Jinja template (`base.html`).
    *   Persistent and always visible (using Bootstrap grid/flex classes).
    *   **Access Logs:** Link to the main access log view (e.g., `/admin/reviews`).
        *   **Notification Badge:** Display pending review count (using Bootstrap `badge` component).
            *   **Implementation:** Flask route passes count to context, or simple JS polling of `/admin/reviews/pending/count` updates badge.
    *   **Employees:** Link to the Employee management list view (e.g., `/admin/employees`).
*   **Routing:** Handled by standard Flask routes defined in `api/routes/`.

## 3. Access Log Views

Served by a route like `/admin/reviews`.

*   **Sections:** Use Bootstrap components (like `nav-tabs` or simple headings) to delineate "Pending", "Today", and "Previous" sections within one template.
    *   **Pending Reviews:** Displays logs with `review_status = 'pending'`.
    *   **Today's Logs:** Displays all logs from the current day.
    *   **Previous Logs:** Displays historical resolved logs.
*   **Layout:**
    *   **Pending & Today's:** Use Jinja loops to render log data as **Bootstrap Cards** in a grid layout (e.g., using Bootstrap's grid system `row`/`col-*`).
        *   **Log Card Structure (Bootstrap):**
            *   Use standard Bootstrap card components (`card`, `card-img-top`, `card-body`, `card-title`, `card-text`, `card-link`).
            *   Display image, details (Timestamp, Method, Employee, Status), and "Details" link (`/admin/reviews/<session_id>`).
        *   **Pagination:** For simplicity and speed, initially display *all* Pending items. Today's items might also be displayed without pagination initially, or use very simple "Next/Previous" page links if necessary. (No carousel).
    *   **Previous Logs:** Use **Bootstrap Table** ([https://bootstrap-table.com/](https://bootstrap-table.com/)) for the table structure and styling.
        *   **Columns:** Image Thumbnail (`<img>`), Employee Name, Timestamp, Decision.
        *   **Pagination:** Use simple "Next/Previous" links generated by Flask.

## 4. Review Details View (`review_details.html`)

Served by `/admin/reviews/<uuid:session_id>`.

*   **Common Elements:** Render core log details. Use Bootstrap `btn` classes for Approve/Deny buttons within HTML forms.
*   **Layout Variations (Jinja + Bootstrap):**
    *   Use Jinja `{% if log.verification_method == '...' %}`.
    *   Structure layouts using Bootstrap grid (`row`/`col-*`) or cards.
    *   **`RFID_ONLY_PENDING_REVIEW`:** Side-by-side cards/columns for captured image and employee details.
    *   **`FACE_ONLY_PENDING_REVIEW`:** Captured image card + potential matches section using Bootstrap cards and standard HTML radio buttons.
    *   **`FACE_VERIFICATION_FAILED`:** Side-by-side cards/columns for captured image and associated employee.
*   **Approve/Deny Actions:** Standard HTML `<form>` elements posting to Flask routes.

## 5. Employee Management View (CRUD)

*   **View (`/admin/employees`):** Jinja template (`employees_list.html`) using a Bootstrap `table` to display employees. Edit/Delete links use Bootstrap `btn` styles.
*   **Create/Update (`/admin/employees/new`, `/admin/employees/<id>/edit`):** Jinja template (`employee_form.html`) using Bootstrap form styling (`form-control`, `form-label`, etc.).
*   **Delete (POST to `/admin/employees/<id>/delete`):** Button in list view table row. Confirmation via basic JS `confirm()`.
*   **Backend Interaction:** Requires Flask routes and `DatabaseService` methods.

## 6. Emergency Status Display

*   **Requirement:** Display a persistent Bootstrap Alert (`alert`, `alert-danger`) at the top of `base.html` when active.
*   **Mechanism:**
    *   **Backend:** Flask API endpoint (`GET /api/status/emergency`) returns `{ "emergency_active": true/false }`.
    *   **Frontend (JS in `base.html`):** `fetch`/`setInterval` polling; JS toggles visibility (e.g., adds/removes `d-none` class) of the alert `div`.

## 7. Required Flask Routes/Endpoints (Summary)

*   `/admin/reviews`: Main access logs view.
*   `/admin/reviews/pending/count` (API - Optional): Returns JSON `{ "count": N }`.
*   `/admin/reviews/<session_id>`: Review details view.
*   `/admin/reviews/<session_id>/approve` (POST): Handles approval.
*   `/admin/reviews/<session_id>/deny` (POST): Handles denial.
*   `/admin/image/<session_id>`: Serves images.
*   `/admin/employees`: Employee list view.
*   `/admin/employees/new`: Show create form.
*   `/admin/employees` (POST): Handle create.
*   `/admin/employees/<employee_id>/edit`: Show edit form.
*   `/admin/employees/<employee_id>/edit` (POST): Handle edit.
*   `/admin/employees/<employee_id>/delete` (POST): Handle deletion.
*   `/api/status/emergency` (API): Returns JSON `{ "emergency_active": true/false }`.

## 8. Styling

*   Utilize **Bootstrap 5** via CDN for core layout, components (cards, tables, forms, badges, alerts), and responsive grid.
*   Utilize **Bootstrap Table** library via CDN for the "Previous Logs" table.
*   Supplement with minimal custom CSS in `static/css/admin.css` as needed.
